#!/usr/local/bin/zsh

pushImage() {
    FN_IMAGE_NAME=${1:-$IMAGE_NAME}
    url="${CONSUL_URL_BASE}/v1/kv/${CONSUL_KV_REPO_TOKEN}?raw"

    REPO_TOKEN=`curl "${url}"`
    echo "Token fetched: $REPO_TOKEN"

    echo "Pushing image $FN_IMAGE_NAME"
    sudo podman push --creds=$REPO_USER:$REPO_TOKEN \
    $FN_IMAGE_NAME
}
