#!/usr/local/bin/zsh
MODE=${2:-'dev'}
source ./bin/config $1 $MODE --nodir

#TOKEN=$(cat ./res/token)
url="${CONSUL_URL_BASE}/v1/kv/${CONSUL_KV_REPO_TOKEN}?raw"

REPO_TOKEN=`curl "${url}"`
echo "Token fetched: $REPO_TOKEN"

echo "Pushing image $IMAGE_NAME"
sudo podman push --creds=$REPO_USER:$REPO_TOKEN \
  $IMAGE_NAME