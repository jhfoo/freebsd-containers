#!/usr/local/bin/zsh
source ./bin/config $1 'IGNORE' --nodir

IMAGE_NAME=$1

#TOKEN=$(cat ./res/token)
url="${CONSUL_URL_BASE}/v1/kv/${CONSUL_KV_REPO_TOKEN}?raw"
REPO_TOKEN=`curl "${url}"`
echo "Token fetched: $REPO_TOKEN"

echo "Pushing image $IMAGE_NAME"
sudo podman push --creds=$REPO_USER:$REPO_TOKEN \
  $IMAGE_NAME